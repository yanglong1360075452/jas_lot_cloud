<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wizinno.jas.user.domain.UserMapper" >
  <resultMap id="BaseResultMap" type="com.wizinno.jas.user.domain.model.User" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 11 10:39:13 CST 2017.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="open_id" property="openId" jdbcType="VARCHAR" />
    <result column="real_name" property="realName" jdbcType="VARCHAR" />
    <result column="sex" property="sex" jdbcType="INTEGER" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="birth_date" property="birthDate" jdbcType="TIMESTAMP" />
    <result column="score_value" property="scoreValue" jdbcType="INTEGER" />
    <result column="head_portrait" property="headPortrait" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
  </resultMap>
  <!--医生和用户表关联查询-->
  <resultMap id="BaseResultUserDoctorMap" type="com.wizinno.jas.user.service.dto.UserDoctorsDto">
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="open_id" property="openId" jdbcType="VARCHAR" />
    <result column="head_portrait" property="headPortrait" jdbcType="VARCHAR" />
    <result column="sex" property="sex" jdbcType="INTEGER" />
    <result column="real_name" property="realName" jdbcType="VARCHAR" />
    <result column="professiona" property="professiona" jdbcType="VARCHAR" />
    <result column="description" property="description" jdbcType="VARCHAR" />
    <result column="hospital" property="hospital" jdbcType="INTEGER" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="department" property="department" jdbcType="INTEGER" />
    <result column="birth_date" property="birthDate" jdbcType="TIMESTAMP" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 11 10:39:13 CST 2017.
    -->
    delete from user
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.wizinno.jas.user.domain.model.User" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 11 10:39:13 CST 2017.
    -->
    insert into user (id, open_id, real_name, 
      sex, phone, birth_date, 
      score_value, head_portrait, create_time,
      update_time)
    values (#{id,jdbcType=BIGINT}, #{openId,jdbcType=VARCHAR}, #{realName,jdbcType=VARCHAR}, 
      #{sex,jdbcType=INTEGER}, #{phone,jdbcType=VARCHAR}, #{birthDate,jdbcType=TIMESTAMP}, 
      #{scoreValue,jdbcType=INTEGER}, #{headPortrait,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP},
      #{updateTime,jdbcType=TIMESTAMP})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.wizinno.jas.user.domain.model.User" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 11 10:39:13 CST 2017.
    -->
    update user
    set open_id = #{openId,jdbcType=VARCHAR},
      real_name = #{realName,jdbcType=VARCHAR},
      sex = #{sex,jdbcType=INTEGER},
      phone = #{phone,jdbcType=VARCHAR},
      birth_date = #{birthDate,jdbcType=TIMESTAMP},
      score_value = #{scoreValue,jdbcType=INTEGER},
      head_portrait = #{headPortrait,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 11 10:39:13 CST 2017.
    -->
    select id, open_id, real_name, sex, phone, birth_date, score_value, head_portrait,
    create_time, update_time
    from user
    where id = #{id,jdbcType=BIGINT}
  </select>
  <!--医生和用户关联查询-->
  <select id="selectUdoctorById" resultMap="BaseResultUserDoctorMap" parameterType="java.lang.Long" >
    select u.real_name,u.sex,u.head_portrait,u.birth_date,d.status,d.hospital,d.professiona,d.description,d.department from user u
    inner join doctor d on  u.id = d.user_id
    where u.id = #{id,jdbcType=BIGINT}
  </select>


  <select id="selectAlls" parameterType="com.wizinno.jas.common.data.PageData" resultMap="BaseResultMap" >
    select u.id, u.open_id, u.real_name, u.sex, u.phone, u.birth_date, u.score_value, u.head_portrait,
    u.create_time, u.update_time
    from user as u
    <if test='param == "" and paramO == ""'>
      left join patient p on u.id = p.user_id
      left join doctor d on u.id = d.user_id
    </if>
    <if test='param != "" and param != null and paramO == "" || paramO == null'>
      right join patient p on u.id = p.user_id
    </if>
    <if test='paramO != "" and paramO != null and param == "" || param == null'>
      right join doctor d on u.id = d.user_id
    </if>
    <if test='name != "" and name != null'>
      where u.real_name LIKE concat('%',#{name,jdbcType=VARCHAR},'%')
    </if>
  </select>
  <!--查询所有注册的康复师-->
  <select id="getUserExamineList" resultType="com.wizinno.jas.user.service.dto.UserDoctorsDto" parameterType="com.wizinno.jas.common.data.PageData" >
    select u.id as id,u.real_name as realName,u.sex as sex,u.birth_date as birthDate,u.phone as phone,u.create_time as createTime,d.status as status from user u
    inner join doctor d on  u.id = d.user_id where 1=1
    <if test='param != "" and param != null'>
      and d.hospital = #{param,jdbcType=VARCHAR}
    </if>
    <if test='paramO != "" and paramO != null'>
      and u.phone LIKE concat('%',#{paramO,jdbcType=VARCHAR},'%')
    </if>
    <if test='paraml != null'>
      and d.status = #{paraml,jdbcType=BIGINT}
    </if>
  </select>

  <select id="selectByOpenId" parameterType="java.lang.String" resultMap="BaseResultMap">
    select id, open_id, real_name, sex, phone, birth_date, score_value, head_portrait,
    create_time, update_time
    from user
    WHERE open_id = #{openId,jdbcType=VARCHAR}
  </select>

  <select id="getUserByPhone" parameterType="java.lang.String" resultMap="BaseResultMap">
    select id, open_id, real_name, sex, phone, birth_date, score_value, head_portrait,
    create_time, update_time
    from user
    WHERE phone = #{phone,jdbcType=VARCHAR}
  </select>
  <select id="getUserListByName" parameterType="java.lang.String" resultMap="BaseResultMap">
    select id,real_name from user
    WHERE real_name like concat('%',#{name,jdbcType=VARCHAR},'%')
  </select>

  <select id="last" resultType="long" useCache="false">
    SELECT LAST_INSERT_ID()
  </select>
</mapper>