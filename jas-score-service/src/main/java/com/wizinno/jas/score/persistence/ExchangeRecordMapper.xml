<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wizinno.jas.score.domain.ExchangeRecordMapper" >
  <resultMap id="BaseResultMap" type="com.wizinno.jas.score.domain.model.ExchangeRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 18 14:29:02 CST 2017.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="user_id" property="userId" jdbcType="BIGINT" />
    <result column="coupon_id" property="couponId" jdbcType="BIGINT" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
  </resultMap>
<!--兑换记录表与优惠券表关联查询-->
  <resultMap id="ERCBaseResultMap" type="com.wizinno.jas.score.service.dto.ERcouponDto" >
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="user_id" property="userId" jdbcType="BIGINT" />
    <result column="coupon_id" property="couponId" jdbcType="BIGINT" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="coupon_password" property="couponPassword" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="validity" property="validity" jdbcType="TIMESTAMP" />
    <result column="redeem_score" property="redeemScore" jdbcType="INTEGER" />
    <result column="coupon_money" property="couponMoney" jdbcType="DOUBLE" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 18 14:29:02 CST 2017.
    -->
    delete from exchange_record
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.wizinno.jas.score.domain.model.ExchangeRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 18 14:29:02 CST 2017.
    -->
    insert into exchange_record (id, user_id, coupon_id, 
      status, create_time, update_time
      )
    values (#{id,jdbcType=BIGINT}, #{userId,jdbcType=BIGINT}, #{couponId,jdbcType=BIGINT}, 
      #{status,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.wizinno.jas.score.domain.model.ExchangeRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 18 14:29:02 CST 2017.
    -->
    update exchange_record
    set user_id = #{userId,jdbcType=BIGINT},
      coupon_id = #{couponId,jdbcType=BIGINT},
      status = #{status,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 18 14:29:02 CST 2017.
    -->
    select id, user_id, coupon_id, status, create_time, update_time
    from exchange_record
    where id = #{id,jdbcType=BIGINT}
  </select>

  <!--优惠券兑换记录表与优惠券表关联查询我的兑换记录-->
  <select id="getChangeRecordList" resultMap="ERCBaseResultMap" >
    select e.create_time,c.redeem_score,c.coupon_money
    from exchange_record e inner join coupon c on e.coupon_id=c.id
    where e.user_id=#{user_id,jdbcType=BIGINT}
  </select>

  <!--优惠券兑换记录表与优惠券表关联查询我兑换的优惠券-->
  <select id="getCouponListByUserId" resultMap="ERCBaseResultMap" >
    select e.create_time,c.validity,c.redeem_score,c.coupon_money,c.coupon_password
    from exchange_record e inner join coupon c on e.coupon_id=c.id
    where e.user_id=#{user_id,jdbcType=BIGINT} and c.validity>now()
  </select>

  <!--优惠券兑换记录表与优惠券表关联查询我的历史优惠券-->
  <select id="getHistoryCouponList" resultMap="ERCBaseResultMap" >
    select e.create_time,c.validity,c.redeem_score,c.coupon_money ,c.coupon_password
    from exchange_record e
    inner join coupon c on e.coupon_id=c.id
    where e.user_id=#{user_id,jdbcType=BIGINT} and c.validity &lt;now()
  </select>


  <select id="selectAll" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Aug 18 14:29:02 CST 2017.
    -->
    select id, user_id, coupon_id, status, create_time, update_time
    from exchange_record
  </select>
</mapper>